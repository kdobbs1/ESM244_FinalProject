---
title: "plot_testing"
author: "Seth (The True) Villanueva"
date: "2023-02-27"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(raster)
library(tidyverse)
library(terra)
library(sf)
library(tmap)
library(Dict)
library(here)
```


### define global variables and functions

```{r}
data_path <- 'fish_data_app/data'

source(here(data_path, 'helper_fxns.R'))
```


### read in macro datasets

```{r}
fish_info <- read_csv(here(data_path, 'fish_info.csv'))

rgns_geog <- read_csv(here(data_path, 'spatial', 'meow_rgns.csv'))
rgn_names_ohi <- read_csv(here(data_path, 'spatial', 'rgn_names_ohi.csv'))
rgns_geog_raster <- raster(here(data_path, 'spatial', 'meow_rgns_mol.tif'))
rgns_geog_raster
plot(rgns_geog_raster)
```

```{r}
eez_raster <- raster(here(data_path, 'spatial', 'eez_mol.tif'))
eez_raster
plot(eez_raster)

ocean_area_raster <- raster(here(data_path, 'spatial', 'ocean_area_mol.tif'))
ocean_area_raster
plot(ocean_area_raster)
```





# Make map of environmental stressors and species range

Where are I/Os located?

Inputs:

  Region
    realm - data/spatial/
                  meow_rgns.csv
                      $realm_code
                      $realm
                  meow_rgns_mol.tif             # maps of the realms?
  Stressor
    name - data/fish_info
                  $species
    area - data/stressor_maps
  Species
    name - data/fish_info
                  $stressor
    range - data/species_ranges
                  `data_source'_spp_mol_`species_name_or_number'.csv
    vulnerability - data/fish_info
                            $vuln

Outputs:
  

### make species lists for conditionals

```{r}
am_species <- c('chanos chanos', 
                'gadus morhua', 
                'mallotus villosus',
                'oncorhynchus mykiss',
                'salmo salar',
                'trichiurus lepturus')

iucn_species <- c('brevoortia patronus',
                  'clupea harengus',
                  'engraulis japonicus',
                  'engraulis ringens',
                  'katsuwonus pelamis',
                  'sardina pilchardus',
                  'sardinella longiceps',
                  'scomber japonicus',
                  'scomber scombrus',
                  'thunnus albacares')

stressor_maps_pollutants <- c('')
```


### subset data

Where I left off: need to keep making file path and name variables. I dont think I need to do the different folders variation, since the stressor maps actually seems to include sea surface temperature extremes.

```{r}
region_choice <- 1
stressor_choice <- 'air_temp'
species_choice <- c('chanos chanos')

# format inputs for feeding to file chains
species_choice_formatted <- sub(' ', '_', tolower(species_choice))


# format file names for calls according to choice
stressor_file_dict <- {}                # make dictionary with all stressor and file names

src <- ''
stressor_path_addition <- ''

# if (stressor_choice %in% c('air_temp')) {
  if (species_choice %in% am_species) {
    src <- 'am'
  }
  if (species_choice %in% iucn_species) {
    src <- 'iucn'
  }
  
  # species_file_prefix <- '_spp_max_temp_'
  
#  stressor_path_addition <- 'sst_rise_maps'
#} else {
  stressor_path_addition <- 'stressor_maps'
#}

stressor_folder_path <- paste(data_path, stressor_path_addition, )
stressor_file_name <- paste(src, species_file_prefix, species_choice_formatted, 'tif)

stress_rast <- raster(here(stressor_folder_path, 'ocean_area_mol.tif'))


```


### make plot

```{r}

```












